---
title: "statistical_ts_models"
author: "Bai Yijian"
date: "2024-09-10"
output: html_document
---

# Preparing
```{r}
library(TSA)
library(vars)
library(urca)
library(HDTSA)
library(forecast)
```

```{r}
# %%
median_income <- read.csv("data/median_income_data_train.csv")
median_income[1:5, ]
str(median_income)

# %%
resale_price <- read.csv("data/resale_price_log_diff_train.csv", row.names = 1)
resale_price[1:5, ]
```

# ARMA

## ACF and PACF plots

```{r}
png("asset/median_income_acf_pacf.png")
par(mfrow = c(2, 1))
acf(
    median_income$income_log_diff,
    ci.type = "ma", main = "ACF of Log Median Income Difference"
)
pacf(
    median_income$income_log_diff,
    main = "PACF of Log Median Income Difference"
)
dev.off()

# %%
png("asset/resale_price_bukit_timah_acf_pacf.png")
par(mfrow = c(2, 1))
acf(
    resale_price$BUKIT.TIMAH,
    ci.type = "ma", main = "ACF of Log Resale Price Difference"
)
pacf(
    resale_price$BUKIT.TIMAH,
    main = "PACF of Log Resale Price Difference"
)
dev.off()
```

## eacf
```{r}
eacf(
    resale_price$BUKIT.TIMAH,
)
```

## fitting

```{r}
resale_price_bukit_timah_arima <- arima(
    resale_price$BUKIT.TIMAH,
    order = c(1, 0, 2)
)
resale_price_bukit_timah_arima
```

```{r}
png("asset/resale_price_bukit_timah_arima_residuals.png")
par(mfrow = c(2, 1))
acf(residuals(resale_price_bukit_timah_arima))
pacf(residuals(resale_price_bukit_timah_arima))
dev.off()
```
## prediction

```{r}
resale_preds=predict(resale_price_bukit_timah_arima,n.ahead = 20)$pred
 
# save
write.csv(resale_preds, file = "data/resale_price_log_diff_arma_pred.csv", row.names = FALSE)
```



# VAR
```{r}
resale_price_var <- VAR(resale_price, ic = "SC")
#summary(resale_price_var)
```

```{r}
resale_price_var_restricted <- restrict(resale_price_var)
BIC(resale_price_var_restricted$varresult$BUKIT.TIMAH)
#summary(resale_price_var_restricted)
```

## prediction

```{r}
resale_price_var_restricted_predict <- predict(
    resale_price_var_restricted,
    n.ahead = 20
)
# save
write.csv(resale_preds, file = "data/resale_price_log_diff_var_pred.csv", row.names = FALSE)
```














